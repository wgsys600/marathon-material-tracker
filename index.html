<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marathon Material Tracker</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #111; color: #eee; }
        select, input[type="text"] { width: 100%; padding: 10px; font-size: 16px; margin-bottom: 20px; }
        .material, .upgrade { margin: 10px 0; padding: 10px; background: #222; border-radius: 5px; }
        .material label, .upgrade label { cursor: pointer; display: block; }
        #trackingList { margin-top: 30px; }
        button { margin-top: 10px; padding: 5px 10px; font-size: 14px; }
    </style>
</head>
<body>

<h1>Marathon Material Tracker</h1>
<select id="modeSelect">
    <option value="materials">Material Search</option>
    <option value="upgrades">Upgrade Tracker</option>
</select>
<input type="text" id="searchInput" placeholder="Search...">
<div id="materialsList"></div>

<h2>ðŸ“‹ Currently Tracking:</h2>
<ul id="trackingList"></ul>
<button onclick="clearTracking()">Clear All</button>

<script>
let materials = [];
let upgrades = [];
const searchInput = document.getElementById('searchInput');
const materialsList = document.getElementById('materialsList');
const trackingList = document.getElementById('trackingList');
const modeSelect = document.getElementById('modeSelect');
let trackingItems = JSON.parse(localStorage.getItem('trackingItems')) || [];

fetch('materials.json')
    .then(response => response.json())
    .then(data => {
        materials = data;
        fetch('upgrades.json')
            .then(response => response.json())
            .then(data => {
                upgrades = data;
                renderView();
                renderTracking();
            });
    });

modeSelect.addEventListener('change', renderView);
searchInput.addEventListener('input', renderView);

function renderView() {
    if (modeSelect.value === 'materials') {
        renderMaterials();
    } else {
        renderUpgrades();
    }
}

function renderMaterials() {
    const query = searchInput.value.toLowerCase();
    materialsList.innerHTML = '';
    materials
        .filter(m => m.Material.toLowerCase().includes(query))
        .forEach((m) => {
            const div = document.createElement('div');
            div.className = 'material';
            const checked = trackingItems.includes(m.Material) ? 'checked' : '';
            div.innerHTML = `
                <label>
                    <input type="checkbox" onchange="toggleTracking('${m.Material}')" ${checked}>
                    <strong>${m.Material}</strong> <br>
                    Map: ${m.Map} | POI 1: ${m["POI 1"]} | POI 2: ${m["POI 2"]}<br>
                    Sources: ${[m["Source 1"], m["Source 2"], m["Source 3"]].filter(s => s).join(", ")}
                </label>
            `;
            materialsList.appendChild(div);
        });
}

function renderUpgrades() {
    const query = searchInput.value.toLowerCase();
    materialsList.innerHTML = '';
    upgrades
        .filter(u => u.Upgrade.toLowerCase().includes(query))
        .forEach((u) => {
            const div = document.createElement('div');
            div.className = 'upgrade';
            div.innerHTML = `
                <label>
                    <button onclick="addUpgradeToTracking('${u.Upgrade}')">Add</button>
                    <strong>${u.Upgrade}</strong> <br>
                    Material 1: ${u["Material 1"]} (${u["#Amount1"]})<br>
                    Material 2: ${u["Material 2"] || 'None'} (${u["#Amount2"] || ''})
                </label>
            `;
            materialsList.appendChild(div);
        });
}

function toggleTracking(material) {
    if (trackingItems.find(t => t.name === material)) {
        trackingItems = trackingItems.filter(t => t.name !== material);
    } else {
        const matData = materials.find(m => m.Material === material);
        if (matData) {
            trackingItems.push({
                name: material,
                map: matData.Map,
                sources: [matData["Source 1"], matData["Source 2"], matData["Source 3"]].filter(s => s)
            });
        }
    }
    localStorage.setItem('trackingItems', JSON.stringify(trackingItems));
    renderTracking();
    renderMaterials();
}

function addUpgradeToTracking(upgradeName) {
    const upgrade = upgrades.find(u => u.Upgrade === upgradeName);
    if (upgrade) {
        trackingItems.push({ name: `Upgrade: ${upgrade.Upgrade}`, isUpgrade: true });
        if (upgrade["Material 1"]) toggleTracking(upgrade["Material 1"]);
        if (upgrade["Material 2"]) toggleTracking(upgrade["Material 2"]);
        trackingItems = trackingItems.filter((item, index, self) =>
            index === self.findIndex(t => t.name === item.name)
        );
        localStorage.setItem('trackingItems', JSON.stringify(trackingItems));
        renderTracking();
    }
}

function renderTracking() {
    trackingList.innerHTML = '';
    trackingItems.forEach(m => {
        const li = document.createElement('li');
        if (m.isUpgrade) {
            li.innerHTML = `<strong>${m.name}</strong>`;
        } else {
            li.innerHTML = `${m.name}<br>Map: ${m.map}<br>Sources: ${m.sources.join(", ")}`;
        }
        trackingList.appendChild(li);
    });
}

function clearTracking() {
    trackingItems = [];
    localStorage.removeItem('trackingItems');
    renderTracking();
    renderView();
}
</script>

</body>
</html>
